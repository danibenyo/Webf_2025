{% extends 'base.html' %}
{% block content %}
<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Savings Goals</h2>
    <a href="{% url 'add_goal' %}" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-purple-700">Add Goal</a>
</div>

<div class="flex flex-col space-y-4 animate__animated animate__fadeInUp">
    {% for goal in goals %}
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col md:flex-row items-center justify-between gap-4">
        <!-- Goal Info (Left) -->
        <div class="flex-grow w-full md:w-auto">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-lg text-gray-800">{{ goal.name }}</h3>
                <div class="text-xs text-gray-500 font-medium">Target: <span class="font-bold text-gray-800">{{ user.userprofile.currency }} {{ goal.target_amount }}</span></div>
            </div>
            
            <div class="w-full bg-gray-100 rounded-full h-3 mb-2">
                <div class="bg-purple-600 h-3 rounded-full transition-all duration-500" style="width: {{ goal.progress_percentage }}%"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-500 font-medium">
                <span>Current: {{ user.userprofile.currency }} {{ goal.current_amount }}</span>
                <span>{{ goal.progress_percentage|floatformat:0 }}%</span>
            </div>
             {% if goal.deadline %}
            <div class="mt-2 text-xs text-gray-400">
                <i class="fa-regular fa-clock mr-1"></i> Due: {{ goal.deadline }}
            </div>
            {% endif %}
        </div>

        <!-- Quick Actions (Right) -->
        <div class="w-full md:w-auto flex items-center gap-4 bg-gray-50 p-3 rounded-lg">
             <form action="{% url 'update_saving_amount' goal.id %}" method="post" class="flex items-center space-x-2">
                {% csrf_token %}
                <input type="number" name="amount" step="0.01" min="0" placeholder="0.00" class="w-20 p-2 text-sm border rounded focus:outline-none focus:border-purple-500" required>
                <button type="submit" name="action" value="add" class="bg-green-100 text-green-600 w-8 h-8 flex items-center justify-center rounded hover:bg-green-200 transition" title="Add"><i class="fa-solid fa-plus"></i></button>
                <button type="submit" name="action" value="subtract" class="bg-red-100 text-red-600 w-8 h-8 flex items-center justify-center rounded hover:bg-red-200 transition" title="Withdraw"><i class="fa-solid fa-minus"></i></button>
            </form>

            <div class="flex space-x-2 border-l pl-4 border-gray-200">
                <a href="{% url 'edit_goal' goal.id %}" class="text-gray-400 hover:text-blue-600"><i class="fa-solid fa-pen"></i></a>
                <form action="{% url 'delete_goal' goal.id %}" method="post" onsubmit="return confirm('Delete goal?');" class="inline">
                    {% csrf_token %}
                    <button class="text-gray-400 hover:text-red-600"><i class="fa-solid fa-trash"></i></button>
                </form>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="p-12 bg-white rounded-xl text-center text-gray-400">
        <div class="text-4xl mb-4 text-purple-200"><i class="fa-solid fa-piggy-bank"></i></div>
        No savings goals yet. Set a target!
    </div>
    {% endfor %}
</div>
{% endblock %}